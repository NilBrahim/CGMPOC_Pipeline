
<!doctype html>
<html>
<head><meta charset="utf-8"><title>PGR POC — Shallow Decision Tree (Δpeak)</title>
<style>
body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
h1, h2 { margin: 8px 0; }
small { color:#666; }
table { border-collapse: collapse; width: 100%; }
th, td { padding: 8px 10px; border-bottom: 1px solid #eee; text-align: left; }
img { max-width: 680px; height: auto; border: 1px solid #eee; border-radius: 8px; padding: 4px; }
</style>
</head>
<body>
  <h1>PGR POC — Decision Tree (Large vs Small Δpeak)</h1>
  <small>Validation: LOPO by participant; Model: depth=3 DecisionTree (class_weight=balanced)</small>

  <h2>Per-fold metrics</h2>
  <table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>left_out_pid</th>
      <th>n_test_meals</th>
      <th>accuracy</th>
      <th>f1</th>
      <th>balanced_acc</th>
      <th>roc_auc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>17</td>
      <td>48</td>
      <td>0.541667</td>
      <td>0.521739</td>
      <td>0.544974</td>
      <td>0.602293</td>
    </tr>
    <tr>
      <td>22</td>
      <td>42</td>
      <td>0.523810</td>
      <td>0.615385</td>
      <td>0.523810</td>
      <td>0.611111</td>
    </tr>
    <tr>
      <td>34</td>
      <td>49</td>
      <td>0.571429</td>
      <td>0.275862</td>
      <td>0.507692</td>
      <td>0.503846</td>
    </tr>
    <tr>
      <td>35</td>
      <td>27</td>
      <td>0.629630</td>
      <td>0.666667</td>
      <td>0.630682</td>
      <td>0.630682</td>
    </tr>
    <tr>
      <td>44</td>
      <td>43</td>
      <td>0.581395</td>
      <td>0.653846</td>
      <td>0.591026</td>
      <td>0.583333</td>
    </tr>
    <tr>
      <td>46</td>
      <td>29</td>
      <td>0.655172</td>
      <td>0.750000</td>
      <td>0.607143</td>
      <td>0.663690</td>
    </tr>
  </tbody>
</table>
  <p><b>Overall</b> — Accuracy: 0.584
     &nbsp; F1: 0.581
     &nbsp; Balanced Acc: 0.568
     &nbsp; ROC-AUC: 0.599</p>

  <h2>Tree diagram</h2>
  <img src="pgr_tree.png" alt="pgr tree">

  <h2>Confusion Matrix (LOPO predictions)</h2>
  <img src="../data/derived/pgr_tree_confusion.png" alt="confusion matrix">

  <h2>Rules (text)</h2>
  <pre style='white-space:pre-wrap'>|--- carbs_g <= 22.500
|   |--- fiber_g <= 0.500
|   |   |--- fat_g <= 2.000
|   |   |   |--- class: 0
|   |   |--- fat_g >  2.000
|   |   |   |--- class: 1
|   |--- fiber_g >  0.500
|   |   |--- protein_g <= 8.000
|   |   |   |--- class: 0
|   |   |--- protein_g >  8.000
|   |   |   |--- class: 0
|--- carbs_g >  22.500
|   |--- gap_prev_meal_hr <= 1.483
|   |   |--- baseline_mgdl <= 118.700
|   |   |   |--- class: 0
|   |   |--- baseline_mgdl >  118.700
|   |   |   |--- class: 0
|   |--- gap_prev_meal_hr >  1.483
|   |   |--- fiber_g <= 9.500
|   |   |   |--- class: 1
|   |   |--- fiber_g >  9.500
|   |   |   |--- class: 0
</pre>

  <h2>Sample predictions (first 30)</h2>
  <table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Person_ID</th>
      <th>meal_time</th>
      <th>y_true</th>
      <th>y_pred</th>
      <th>y_prob</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>17</td>
      <td>2023-10-10 13:20</td>
      <td>1</td>
      <td>0</td>
      <td>0.380350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-10 20:30</td>
      <td>0</td>
      <td>0</td>
      <td>0.067350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-10 22:40</td>
      <td>0</td>
      <td>1</td>
      <td>0.600326</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-11 10:21</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-11 14:11</td>
      <td>1</td>
      <td>0</td>
      <td>0.380350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-11 20:42</td>
      <td>0</td>
      <td>0</td>
      <td>0.067350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-11 22:15</td>
      <td>1</td>
      <td>0</td>
      <td>0.369775</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-11 22:35</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-12 11:39</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-12 14:43</td>
      <td>0</td>
      <td>0</td>
      <td>0.067350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-12 20:27</td>
      <td>0</td>
      <td>0</td>
      <td>0.067350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-12 21:50</td>
      <td>0</td>
      <td>0</td>
      <td>0.380350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-12 22:17</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-13 11:36</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-13 15:05</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-13 19:01</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-13 22:07</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-13 22:15</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 08:27</td>
      <td>1</td>
      <td>0</td>
      <td>0.380350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 13:04</td>
      <td>0</td>
      <td>0</td>
      <td>0.067350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 17:59</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 18:47</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 18:54</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-14 21:00</td>
      <td>1</td>
      <td>0</td>
      <td>0.369775</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-15 11:00</td>
      <td>0</td>
      <td>1</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-15 14:06</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-15 19:42</td>
      <td>1</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-15 20:03</td>
      <td>0</td>
      <td>1</td>
      <td>0.639411</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-16 01:19</td>
      <td>1</td>
      <td>0</td>
      <td>0.380350</td>
    </tr>
    <tr>
      <td>17</td>
      <td>2023-10-16 02:25</td>
      <td>0</td>
      <td>1</td>
      <td>0.600326</td>
    </tr>
  </tbody>
</table>
</body>
</html>
